# MCPプロキシサーバ作成プラン

## 概要
Devin MCP APIの`ask_question`ツールを呼び出すプロキシMCPサーバを作成する。

## 要件
- Devin MCP API (https://docs.devin.ai/work-with-devin/devin-mcp) を呼び出す
- 使用ツール: `ask_question`のみ
- 固定リポジトリ: `smartfnexta/pms`
- APIキーは`.env`ファイルから読み込み

## 主な機能

### 1. プロキシツール: `ask_question`
- **入力パラメータ**: 
  - `question` (string): ユーザからの質問
- **固定パラメータ**: 
  - `repoName`: `"smartfnexta/pms"`
- **出力**: Devin MCPからのレスポンス

### 2. 認証管理
- `.env`ファイルからDevin APIキーを読み込み
- HTTPヘッダー: `Authorization: Bearer <API_KEY>`

### 3. API呼び出し仕様
- **エンドポイント**: `https://mcp.devin.ai/sse`
- **リクエスト形式**:
```json
{
  "mcp_sse_call_tool": {
    "arguments": "{\"repoName\": \"smartfnexta/pms\", \"question\": \"[ユーザからの質問]\"}",
    "tool_name": "ask_question"
  }
}
```

## 技術構成

### ベースフレームワーク
- **FastMCP**: MCPサーバフレームワーク
- **Python**: 実装言語
- **SSE**: トランスポート方式

### 依存パッケージ
- `fastmcp`: MCPサーバ作成
- `requests` または `httpx`: HTTP通信
- `python-dotenv`: 環境変数管理

### ファイル構成
```
/home/kohzih/worksapce/devinmcp/
├── main.py              # メインサーバファイル
├── .env                 # APIキー設定ファイル
├── requirements.txt     # 依存パッケージ
├── 要件.md             # 要件定義
├── プラン.md           # このファイル
└── CLAUDE.md           # Claude Code用設定
```

## 実装ステップ

### Phase 1: 環境セットアップ
1. Devin MCP APIの仕様調査と理解
2. FastMCPでの外部API呼び出し機能の設計
3. .env設定によるAPIキー管理機能の実装

### Phase 2: コア機能実装
4. ask_questionツールのプロキシ機能実装
5. HTTPSリクエスト処理とエラーハンドリング
6. パラメータ検証とセキュリティ対策

### Phase 3: テスト・デバッグ
7. 動作テストとデバッグ機能

## セキュリティ考慮事項
- APIキーの安全な管理（.envファイル、環境変数）
- 入力パラメータの検証とサニタイゼーション
- エラーレスポンスでの機密情報漏洩防止
- HTTPSによる通信の暗号化

## エラーハンドリング
- ネットワークエラー
- API認証エラー
- Devin MCP APIエラー
- パラメータ検証エラー
- タイムアウト処理

## 動作確認項目
1. 環境変数からのAPIキー読み込み
2. Devin MCP APIへの正常な接続
3. ask_questionツールの動作
4. エラー時の適切なレスポンス
5. SSEトランスポートでの通信確認